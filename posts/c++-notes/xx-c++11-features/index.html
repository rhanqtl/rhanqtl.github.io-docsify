<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="zh-cn" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.111.3">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>C&#43;&#43;11 新特性笔记 | rhanqtl</title>
<meta name="description" content="本文参照 Bjarne 在 HOPL IV 列出的大纲整理 C&#43;&#43;11 新特性的要点。
语言特性 auto 和 decltype auto 用于根据 initializer 推断数据对象的类型
auto i = 7; // i is an int auto d = 7.2; // d is a double auto it = v.begin(); // p gets the type of v&amp;#39;s iterator auto 在 C 中本来用于标记变量是一个“自动（automatic）变量”，C&#43;&#43;11 复用了这个关键字。 据 Bjarne 的说法，他在 1982/83 就实现了 auto 类型推断，但是为了保持与 C 的兼容性又给移除了。 除了减少输入的好处，auto 还能够表示一些很复杂的类型，例如 lambda 表达式的类型：
auto cmp = [](int lhs, int rhs) { return lhs &amp;gt; rhs; }; 不过 auto 有一些需要注意的地方：">
<meta property="og:title" content="C&#43;&#43;11 新特性笔记" />
<meta property="og:description" content="本文参照 Bjarne 在 HOPL IV 列出的大纲整理 C&#43;&#43;11 新特性的要点。
语言特性 auto 和 decltype auto 用于根据 initializer 推断数据对象的类型
auto i = 7; // i is an int auto d = 7.2; // d is a double auto it = v.begin(); // p gets the type of v&#39;s iterator auto 在 C 中本来用于标记变量是一个“自动（automatic）变量”，C&#43;&#43;11 复用了这个关键字。 据 Bjarne 的说法，他在 1982/83 就实现了 auto 类型推断，但是为了保持与 C 的兼容性又给移除了。 除了减少输入的好处，auto 还能够表示一些很复杂的类型，例如 lambda 表达式的类型：
auto cmp = [](int lhs, int rhs) { return lhs &gt; rhs; }; 不过 auto 有一些需要注意的地方：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/c&#43;&#43;-notes/xx-c&#43;&#43;11-features/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-05-08T00:00:00+00:00" /><meta property="og:site_name" content="rhanqtl" />
<meta itemprop="name" content="C&#43;&#43;11 新特性笔记">
<meta itemprop="description" content="本文参照 Bjarne 在 HOPL IV 列出的大纲整理 C&#43;&#43;11 新特性的要点。
语言特性 auto 和 decltype auto 用于根据 initializer 推断数据对象的类型
auto i = 7; // i is an int auto d = 7.2; // d is a double auto it = v.begin(); // p gets the type of v&#39;s iterator auto 在 C 中本来用于标记变量是一个“自动（automatic）变量”，C&#43;&#43;11 复用了这个关键字。 据 Bjarne 的说法，他在 1982/83 就实现了 auto 类型推断，但是为了保持与 C 的兼容性又给移除了。 除了减少输入的好处，auto 还能够表示一些很复杂的类型，例如 lambda 表达式的类型：
auto cmp = [](int lhs, int rhs) { return lhs &gt; rhs; }; 不过 auto 有一些需要注意的地方："><meta itemprop="datePublished" content="2023-05-08T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-05-08T00:00:00+00:00" />
<meta itemprop="wordCount" content="2290">
<meta itemprop="keywords" content="c/c&#43;&#43;," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="C&#43;&#43;11 新特性笔记"/>
<meta name="twitter:description" content="本文参照 Bjarne 在 HOPL IV 列出的大纲整理 C&#43;&#43;11 新特性的要点。
语言特性 auto 和 decltype auto 用于根据 initializer 推断数据对象的类型
auto i = 7; // i is an int auto d = 7.2; // d is a double auto it = v.begin(); // p gets the type of v&#39;s iterator auto 在 C 中本来用于标记变量是一个“自动（automatic）变量”，C&#43;&#43;11 复用了这个关键字。 据 Bjarne 的说法，他在 1982/83 就实现了 auto 类型推断，但是为了保持与 C 的兼容性又给移除了。 除了减少输入的好处，auto 还能够表示一些很复杂的类型，例如 lambda 表达式的类型：
auto cmp = [](int lhs, int rhs) { return lhs &gt; rhs; }; 不过 auto 有一些需要注意的地方："/>




<link rel="preload" href="/scss/main.min.bb1f3a37154c4661ae02d3cb1a733edd8005db70f626370ca004c689a63ab7d4.css" as="style">
<link href="/scss/main.min.bb1f3a37154c4661ae02d3cb1a733edd8005db70f626370ca004c689a63ab7d4.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-page td-blog">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="navbar-brand__name">rhanqtl</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link active" href="/posts/"><span class="active">原创博文</span></a>
      </li>
      <li class="nav-item mr-4 mb-2 mb-lg-0">
        <a class="nav-link" href="/about/"><span>个人简历</span></a>
      </li>
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    
  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-posts-li">
  <a href="/posts/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-posts"><span class="">原创博文</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-postsc-notes-li">
  <a href="/posts/c&#43;&#43;-notes/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-postsc-notes"><span class="">C&#43;&#43; 程序设计笔记</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-postsc-notesxx-c11-features-li">
  <a href="/posts/c&#43;&#43;-notes/xx-c&#43;&#43;11-features/" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-postsc-notesxx-c11-features"><span class="td-sidebar-nav-active-item">C&#43;&#43;11 新特性笔记</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-poststools-li">
  <a href="/posts/tools/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-poststools"><span class="">工具</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-poststoolscommand-line-roadmap-li">
  <a href="/posts/tools/command-line-roadmap/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-poststoolscommand-line-roadmap"><span class="">Linux 命令行操作学习路线图</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-poststoolsmigrating-from-coder-to-docsy-li">
  <a href="/posts/tools/migrating-from-coder-to-docsy/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-poststoolsmigrating-from-coder-to-docsy"><span class="">博客主题迁移：从 Coder 到 Docsy</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-poststoolsvscode-shortcut-cheatsheet-li">
  <a href="/posts/tools/vscode-shortcut-cheatsheet/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-poststoolsvscode-shortcut-cheatsheet"><span class="">VS Code 快捷键速查表</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-poststoolsgit-cheatsheet-li">
  <a href="/posts/tools/git-cheatsheet/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-poststoolsgit-cheatsheet"><span class="">Git 不常用命令速查（持续更新）</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-poststoolsc-dev-setup-with-vscode-li">
  <a href="/posts/tools/c&#43;&#43;-dev-setup-with-vscode/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-poststoolsc-dev-setup-with-vscode"><span class="">Visual Studio Code C/C&#43;&#43; 开发环境搭建</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-postscompilers-li">
  <a href="/posts/compilers/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-postscompilers"><span class="">编译技术</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postscompilersssa-construction-li">
  <a href="/posts/compilers/ssa-construction/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postscompilersssa-construction"><span class="">构造 SSA 形式</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postscompilersoptllvm-passeswriting-an-llvm-pass-li">
  <a href="/posts/compilers/opt/llvm-passes/writing-an-llvm-pass/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postscompilersoptllvm-passeswriting-an-llvm-pass"><span class="">实现一个 LLVM Pass</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postscompilersoptllvm-passesmem2reg-li">
  <a href="/posts/compilers/opt/llvm-passes/mem2reg/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postscompilersoptllvm-passesmem2reg"><span class="">理解 mem2reg</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postscompilerstipsconstruct-lists-in-bison-li">
  <a href="/posts/compilers/tips/construct-lists-in-bison/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postscompilerstipsconstruct-lists-in-bison"><span class="">在 Bison 中如何构造列表</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postscompilerstipslexical-tie-ins-li">
  <a href="/posts/compilers/tips/lexical-tie-ins/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postscompilerstipslexical-tie-ins"><span class="">Bison 小技巧：tie-in</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postscompilersbuild-your-own-programming-language01-flex-bison-intro-li">
  <a href="/posts/compilers/build-your-own-programming-language/01-flex-bison-intro/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postscompilersbuild-your-own-programming-language01-flex-bison-intro"><span class="">用 Flex 和 Bison 实现一个计算器</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-postsdesign-patterns-li">
  <a href="/posts/design-patterns/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-postsdesign-patterns"><span class="">设计模式</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postsdesign-patternsvisitor-li">
  <a href="/posts/design-patterns/visitor/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postsdesign-patternsvisitor"><span class="">Visitor 模式</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postsgolang-and-duck-typing-li">
  <a href="/posts/golang-and-duck-typing/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postsgolang-and-duck-typing"><span class="">Go 和 Duck Typing</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postssieve-of-eratosthenes-li">
  <a href="/posts/sieve-of-eratosthenes/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postssieve-of-eratosthenes"><span class="">埃氏筛法及其实现</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postshow-to-launch-apps-from-web-browsers-li">
  <a href="/posts/how-to-launch-apps-from-web-browsers/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postshow-to-launch-apps-from-web-browsers"><span class="">如何从浏览器启动应用程序</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postsoj-solutionsleetcode640-li">
  <a href="/posts/oj-solutions/leetcode/640/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postsoj-solutionsleetcode640"><span class="">LeetCode 640. 求解方程</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postsgolang-http-pattern-matching-rule-and-gorilla-li">
  <a href="/posts/golang-http-pattern-matching-rule-and-gorilla/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postsgolang-http-pattern-matching-rule-and-gorilla"><span class="">Go 标准库 net/http 模式匹配规则与 gorilla/mux</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-postsdavid-in-v2ray-core-source-code-li">
  <a href="/posts/david-in-v2ray-core-source-code/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-postsdavid-in-v2ray-core-source-code"><span class="">v2ray-core 源码中的大卫像</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">

</div>

            
            

	
		



  
  

	
		



  
  
    <div class="taxonomy taxonomy-terms-cloud taxo-tags">
      
        <h5 class="taxonomy-title">Tags</h5>
      
      <ul class="taxonomy-terms">
        
          <li><a class="taxonomy-term" href="/tags/bison/" data-taxonomy-term="bison"><span class="taxonomy-label">Bison</span><span class="taxonomy-count">3</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/c/c&#43;&#43;/" data-taxonomy-term="c/c&#43;&#43;"><span class="taxonomy-label">c/c&#43;&#43;</span><span class="taxonomy-count">2</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/design-pattern/" data-taxonomy-term="design-pattern"><span class="taxonomy-label">Design Pattern</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/flex/" data-taxonomy-term="flex"><span class="taxonomy-label">Flex</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/git/" data-taxonomy-term="git"><span class="taxonomy-label">Git</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/golang/" data-taxonomy-term="golang"><span class="taxonomy-label">golang</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/hugo/" data-taxonomy-term="hugo"><span class="taxonomy-label">Hugo</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/lex/" data-taxonomy-term="lex"><span class="taxonomy-label">Lex</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/llvm/" data-taxonomy-term="llvm"><span class="taxonomy-label">LLVM</span><span class="taxonomy-count">2</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/ssa/" data-taxonomy-term="ssa"><span class="taxonomy-label">SSA</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/type-system/" data-taxonomy-term="type-system"><span class="taxonomy-label">type-system</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/vs-code/" data-taxonomy-term="vs-code"><span class="taxonomy-label">VS Code</span><span class="taxonomy-count">2</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/yacc/" data-taxonomy-term="yacc"><span class="taxonomy-label">Yacc</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/%E5%B7%A5%E5%85%B7%E9%93%BE/" data-taxonomy-term="%E5%B7%A5%E5%85%B7%E9%93%BE"><span class="taxonomy-label">工具链</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" data-taxonomy-term="%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="taxonomy-label">开发工具</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96/" data-taxonomy-term="%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96"><span class="taxonomy-label">编译优化</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/%E7%BC%96%E8%AF%91%E5%99%A8/" data-taxonomy-term="%E7%BC%96%E8%AF%91%E5%99%A8"><span class="taxonomy-label">编译器</span><span class="taxonomy-count">6</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" data-taxonomy-term="%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="taxonomy-label">设计模式</span><span class="taxonomy-count">1</span></a></li>
        
          <li><a class="taxonomy-term" href="/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/" data-taxonomy-term="%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="taxonomy-label">静态分析</span><span class="taxonomy-count">1</span></a></li>
        
      </ul>
    </div>
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5 pe-md-4" role="main">
            <a class="td-rss-button" title="RSS" href="/posts/c&#43;&#43;-notes/index.xml" target="_blank" rel="noopener">
              <i class="fa-solid fa-rss" aria-hidden="true"></i>
            </a>
            
<div class="td-content">
	<h1>C&#43;&#43;11 新特性笔记</h1>
	
	<div class="td-byline mb-4">
		
		<time datetime="2023-05-08" class="text-muted">Monday, May 08, 2023</time>
	</div>
	<header class="article-meta">
		

  
    


  
    


<div class="taxonomy taxonomy-terms-article taxo-tags">
  <h5 class="taxonomy-title">Tags:</h5>
  <ul class="taxonomy-terms">
    
      <li><a class="taxonomy-term" href="/tags/c/c&#43;&#43;/" data-taxonomy-term="c/c&#43;&#43;"><span class="taxonomy-label">c/c&#43;&#43;</span></a></li>
    
  </ul>
</div>

  

		
			<p class="reading-time"><i class="fa-solid fa-clock" aria-hidden="true"></i>&nbsp; 11 分钟阅读 &nbsp;</p>

		
	</header>
	<div class="paragraph">
<p>本文参照 Bjarne 在 HOPL IV 列出的大纲整理 C++11 新特性的要点。</p>
</div>
<div class="sect1">
<h2 id="_语言特性">语言特性</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_auto_和_decltype">auto 和 decltype</h3>
<div class="paragraph">
<p><code>auto</code> 用于根据 initializer 推断数据对象的类型</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">7</span><span style="background-color: #f8f8f8">;</span>          <span style="color: #999988;font-style: italic">// i is an int</span>
<span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">d</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">7.2</span><span style="background-color: #f8f8f8">;</span>        <span style="color: #999988;font-style: italic">// d is a double</span>
<span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">it</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">begin</span><span style="background-color: #f8f8f8">();</span> <span style="color: #999988;font-style: italic">// p gets the type of v&#39;s iterator</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>auto</code> 在 C 中本来用于标记变量是一个“自动（automatic）变量”，C++11 复用了这个关键字。
</td>
</tr>
</tbody></table>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
据 Bjarne 的说法，他在 1982/83 就实现了 <code>auto</code> 类型推断，但是为了保持与 C 的兼容性又给移除了。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>除了减少输入的好处，<code>auto</code> 还能够表示一些很复杂的类型，例如 lambda 表达式的类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">cmp</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">lhs</span><span style="background-color: #f8f8f8">,</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">lhs</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>不过 <code>auto</code> 有一些需要注意的地方：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">r1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #000000;font-weight: bold">const</span> <span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">r2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">;</span>

    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">r1</span><span style="background-color: #f8f8f8">;</span>  <span style="color: #999988;font-style: italic">// x is of type int rather than int &amp;</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">y</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">r2</span><span style="background-color: #f8f8f8">;</span>  <span style="color: #999988;font-style: italic">// y is of type int</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">z</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">r1</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// z is of type int &amp;</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">w</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">r2</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// w is of type const int &amp;</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>auto</code> 一般会忽略顶层 <code>const</code>，保留底层 <code>const</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #000000;font-weight: bold">const</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">ci</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">cr</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">ci</span><span style="background-color: #f8f8f8">;</span>

    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">b</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">ci</span><span style="background-color: #f8f8f8">;</span>  <span style="color: #999988;font-style: italic">// int</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">c</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">cr</span><span style="background-color: #f8f8f8">;</span>  <span style="color: #999988;font-style: italic">// int</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">d</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">;</span>  <span style="color: #999988;font-style: italic">// int *</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">ci</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// const int *</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果想要保留顶层 <code>const</code>，需要显式指定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">*</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">p</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">a</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">p</span><span style="background-color: #f8f8f8">;</span>       <span style="color: #999988;font-style: italic">// int *</span>
    <span style="color: #000000;font-weight: bold">const</span> <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">b</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">p</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// int *const</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>除此之外，C++11 还引入了尾置返回类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999988;font-style: italic">// These two are equivalent:</span>
<span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #445588;font-weight: bold">int</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// -&gt;int is optional</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>decltype</code> 用于在不求值的情况下获取表达式的类型，可以用来：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>声明返回类型</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999988;font-style: italic">// error: x was not declared in this scope</span>
<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T2</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">+</span><span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T1</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">T2</span> <span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">...</span> <span style="background-color: #f8f8f8">}</span>

<span style="color: #999988;font-style: italic">// Instead, use</span>
<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T2</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">bar</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T1</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">T2</span> <span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">-&gt;</span> <span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">+</span><span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">...</span> <span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>模板元编程</p>
</li>
<li>
<p>传递 lambda 的类型，详见后面关于 lambda 的部分</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>decltype</code> 会保留顶层 <code>const</code> 和引用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">const</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">ci</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">cr</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">ci</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ci</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// const int, OK</span>
<span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cr</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">y</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// const int &amp;, OK</span>
<span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cr</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">z</span><span style="background-color: #f8f8f8">;</span>     <span style="color: #999988;font-style: italic">// const int &amp;, error</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>特别需要注意的是如下的情况：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">((</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">))</span> <span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">;</span> <span style="color: #999988;font-style: italic">// int &amp;, error</span>
<span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">b</span><span style="background-color: #f8f8f8">;</span>   <span style="color: #999988;font-style: italic">// int</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>即，<code>decltypev</code> 永远是引用，而 <code>decltype(v)</code> 只有在 <code>v</code> 本身是引用时才是引用</p>
</div>
</div>
<div class="sect2">
<h3 id="_lambda_表达式">lambda 表达式</h3>
<div class="paragraph">
<p>在 C++11 之前，如果一个函数需要另一个函数作为参数，有两种选择：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>从 C 继承下来的函数指针</p>
</li>
<li>
<p>传入一个重载了 <code>operator()</code> 的类型的对象，有时候称为“functor”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这两个选择存在同一个问题：如果一个简单函数仅会被调用一次，依然要完整地将其定义出来（函数指针还不能捕获词法作用域中的数据对象）。lambda 表达式作为匿名函数改变了这一点。</p>
</div>
<div class="paragraph">
<p>lambda 表达式的完整形式：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[] () mutable throw-spec -&gt;return-type { ... }</pre>
</div>
</div>
<div class="paragraph">
<p>其中 <code>()</code> <code>mutable</code>、<em>throw-spec</em> 和 <em>→return-type</em> 都是可选的，但是任何一个出现，参数列表 <code>()</code> 都必须出现：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[]</code> 是捕获列表，用于指定如何捕获词法作用域中的非静态数据对象</p>
</li>
<li>
<p><code>()</code> 是参数列表</p>
</li>
<li>
<p><code>mutable</code> 是一个关键字，用于声明按值捕获的数据能否修改</p>
</li>
<li>
<p>throw-spec 可以是 <code>noexcept</code> 和 <code>throw</code>（除了 <code>throw()</code>，其他形式在 C++11 废弃）</p>
</li>
<li>
<p>return-type 用于标示返回类型，大多数情况下都能够根据返回值自动推导</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// uniform initialization</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">nums</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #009999">4</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">6</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">1</span> <span style="background-color: #f8f8f8">};</span>
    <span style="color: #999988;font-style: italic">// reverse order</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">sort</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">begin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">end</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">lhs</span><span style="background-color: #f8f8f8">,</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">lhs</span> <span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">});</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在 cppinsights.io 看到 Clang 是通过 <code>struct</code> 来实现的。</p>
</div>
<div class="paragraph">
<p>捕获有两种形式：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>按值捕获 by value，使用 <code>=</code> 表示</p>
</li>
<li>
<p>按引用捕获 by reference，使用 <code>&amp;</code> 表示</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一个 <code>lambda</code> 可以在捕获列表的最开始指定默认的捕获方式，然后额外指定以相反方式捕获的数据对象。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">target</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">nums</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #009999">4</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">6</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">1</span> <span style="background-color: #f8f8f8">};</span>
    <span style="color: #999988;font-style: italic">// capture by value</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">count_if</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">cbegin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">cend</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">target</span><span style="background-color: #f8f8f8">](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">==</span> <span style="background-color: #f8f8f8">target</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">});</span>
<span style="background-color: #f8f8f8">}</span>

<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">bar</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">y</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #999988;font-style: italic">// capture x by value and y by reference</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">f1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">{};</span>
    <span style="color: #999988;font-style: italic">// capture y by reference and all other objects by value</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">f2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">=</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">{};</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>被捕获的数据对象必须以某种方式指定了捕获方式，否则编译失败：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">target</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">nums</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #009999">4</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">6</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">1</span> <span style="background-color: #f8f8f8">};</span>
    <span style="color: #999988;font-style: italic">// error: variable &#39;target&#39; cannot be implicitly captured in a lambda with no capture-default specified</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">count_if</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">cbegin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">cend</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">==</span> <span style="background-color: #f8f8f8">target</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">});</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>按值捕获的数据对象在 lambda 的函数体中是不能够修改的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// error: cannot assign to a variable captured by copy in a non-mutable lambda</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">f</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">++</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">};</span>

    <span style="color: #999988;font-style: italic">// OK. Notice the empty argument list.</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">g</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">mutable</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">++</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">};</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>从 cppinsights 可以看到如果没有 <code>mutable</code>，lambda 所对应的函数对象的 <code>operator()</code> 带有 <code>const</code> 标记（这里同时也需要注意，每个 lambda 对应的匿名函数对象的类型都是不同的）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">int</span> <span style="color: #990000;font-weight: bold">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
  <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
  <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">f</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">{};</span>
  <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">g</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">mutable</span> <span style="background-color: #f8f8f8">{};</span>
  <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">h</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">{};</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>特别注意，按值捕获的数据对象在 lambda 的函数体中跟原来的是不同的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">f</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">]</span> <span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">mutable</span> <span style="background-color: #f8f8f8">{</span>
        <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#39;\n&#39;</span><span style="background-color: #f8f8f8">;</span>
        <span style="background-color: #f8f8f8">x</span><span style="color: #000000;font-weight: bold">++</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">};</span>
    <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">();</span> <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">();</span> <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#39;\n&#39;</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>输出为</p>
</div>
<div class="literalblock">
<div class="content">
<pre>0
1
2
42</pre>
</div>
</div>
<div class="paragraph">
<p>还需要注意的是，lambda 没有默认的构造函数和赋值操作符（很遗憾，也无法指定），但是可以有默认的拷贝构造函数和移动构造函数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">cmp</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">[](</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">Person</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">lhs</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">Person</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">lhs</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">last_name</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">last_name</span><span style="background-color: #f8f8f8">())</span> <span style="color: #000000;font-weight: bold">||</span>
           <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">lhs</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">last_name</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">==</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">last_name</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="background-color: #f8f8f8">lhs</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">first_name</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">&lt;</span> <span style="background-color: #f8f8f8">rhs</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">first_name</span><span style="background-color: #f8f8f8">());</span>
<span style="background-color: #f8f8f8">};</span>

<span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">set</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Person</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cmp</span><span style="background-color: #f8f8f8">)</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">people</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cmp</span><span style="background-color: #f8f8f8">);</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>这里 <code>cmp</code> 是必须传入的，否则会调用 <code>set</code> 的默认构造函数，它会调用 lambda 的默认构造函数：
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Key</span><span style="background-color: #f8f8f8">,</span>
          <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Compare</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">less</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Key</span><span style="background-color: #f8f8f8">&gt;,</span>
          <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Alloc</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">alloc</span><span style="color: #000000;font-weight: bold">&gt;</span>
<span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">set</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">...</span>
<span style="color: #990000;font-weight: bold">public:</span>
  <span style="color: #999988;font-style: italic">// t is a field of type rb_tree</span>
  <span style="background-color: #f8f8f8">set</span><span style="background-color: #f8f8f8">()</span><span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">t</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">Compare</span><span style="background-color: #f8f8f8">())</span> <span style="background-color: #f8f8f8">{}</span>
  <span style="color: #000000;font-weight: bold">explicit</span> <span style="background-color: #f8f8f8">set</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">Compare</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">comp</span><span style="background-color: #f8f8f8">)</span><span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">t</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">comp</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{}</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div></td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>最后一个需要注意的地方是捕获 <code>this</code> 的方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Scaler</span> <span style="background-color: #f8f8f8">{</span>
<span style="color: #990000;font-weight: bold">public:</span>
    <span style="color: #000000;font-weight: bold">explicit</span> <span style="background-color: #f8f8f8">Scaler</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">s</span><span style="background-color: #f8f8f8">)</span><span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">scale_</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">s</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{}</span>

    <span style="color: #999988;font-style: italic">// error: &#39;this&#39; was not captured for this lambda function</span>
    <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">apply_1</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
        <span style="background-color: #f8f8f8">for_each</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">begin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">end</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">n</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">n</span> <span style="color: #000000;font-weight: bold">*</span> <span style="background-color: #f8f8f8">scale_</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">endl</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">});</span>
    <span style="background-color: #f8f8f8">}</span>

    <span style="color: #999988;font-style: italic">// capture &#34;this&#34; by reference</span>
    <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">apply_2</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #999988;font-style: italic">// scale_ *= 2; // error: assignment of &#39;Scaler::scale_&#39; in read-only object (even if with mutable)</span>
        <span style="background-color: #f8f8f8">for_each</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">begin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">end</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">this</span><span style="background-color: #f8f8f8">](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">n</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">n</span> <span style="color: #000000;font-weight: bold">*</span> <span style="background-color: #f8f8f8">scale_</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">endl</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">});</span>
    <span style="background-color: #f8f8f8">}</span>

    <span style="color: #999988;font-style: italic">// capture &#34;this&#34; by ref implicitly, &#39;&amp;&#39; also works</span>
    <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">apply_3</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">{</span>
        <span style="background-color: #f8f8f8">for_each</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">begin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">end</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">=</span><span style="background-color: #f8f8f8">](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">n</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">n</span> <span style="color: #000000;font-weight: bold">*</span> <span style="background-color: #f8f8f8">scale_</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">endl</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">});</span>
    <span style="background-color: #f8f8f8">}</span>

<span style="color: #990000;font-weight: bold">private:</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">scale_</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>详见<a href="https://www.nextptr.com/tutorial/ta1430524603/capture-this-in-lambda-expression-timeline-of-change">这篇文章</a>最开始的表格。</p>
</div>
<div class="paragraph">
<p>如果想要按值捕获 <code>this</code>，在 C++11 中只能这样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">apply</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="background-color: #f8f8f8">copy</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">*</span><span style="color: #000000;font-weight: bold">this</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">for_each</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">begin</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">v</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">end</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">[</span><span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">copy</span><span style="background-color: #f8f8f8">](</span><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">n</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">...</span> <span style="background-color: #f8f8f8">});</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_移动语义和右值引用">移动语义和右值引用</h3>
<div class="sect3">
<h4 id="_universal_reference">Universal Reference</h4>
<div class="paragraph">
<p><code>&amp;&amp;</code> 并不总是表示右值引用</p>
</div>
<div class="paragraph">
<p>详情参见 <a href="https://isocpp.org/blog/2012/11/universal-references-in-c11-scott-meyers" class="bare">https://isocpp.org/blog/2012/11/universal-references-in-c11-scott-meyers</a></p>
</div>
<div class="paragraph">
<p>对日常编程最有用的经验法则：如果变量或者形参被声明为 <code>T &amp;&amp;</code> 类型，而 <code>T</code> 是一个推导类型（deduced type），那么这个变量或者形参是 universal reference，注意到 <code>auto</code> 使用跟模板相同的类型推断方法，因此 <code>auto &amp;&amp;</code> 也可以是 universal reference。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">take_lref_only</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">arg</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">static_assert</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">is_lvalue_reference</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">value</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">&#34;not a lvalue reference&#34;</span><span style="background-color: #f8f8f8">);</span>
<span style="background-color: #f8f8f8">}</span>

<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">a</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">take_lref_only</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">);</span>
    <span style="color: #000000;font-weight: bold">auto</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">b</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">;</span>
    <span style="color: #000000;font-weight: bold">static_assert</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">is_lvalue_reference</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">decltype</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">b</span><span style="background-color: #f8f8f8">)</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">value</span><span style="background-color: #f8f8f8">,</span> <span style="color: #d14">&#34;not a lvalue reference&#34;</span><span style="background-color: #f8f8f8">);</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>编译能够通过，在 cppinsights 可以看到这样的字样：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999988;font-style: italic">/* PASSED: static_assert(std::integral_constant&lt;bool, 1&gt;::value); */</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
右值一般满足如下条件之一：（1）临时对象；（2）没有名字；（3）不能取地址。
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>不过下面的 <code>&amp;&amp;</code> 不是 universal reference：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">param</span><span style="background-color: #f8f8f8">);</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">param</span><span style="background-color: #f8f8f8">);</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Allocator</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">allocator</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="background-color: #f8f8f8">&gt;</span><span style="color: #000000;font-weight: bold">&gt;</span>
<span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">vector</span> <span style="background-color: #f8f8f8">{</span>
<span style="color: #990000;font-weight: bold">public:</span>
    <span style="background-color: #f8f8f8">...</span>
    <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">push_back</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">);</span>       <span style="color: #999988;font-style: italic">// fully specified parameter type ⇒ no type deduction;</span>
    <span style="background-color: #f8f8f8">...</span>                          <span style="color: #999988;font-style: italic">// &amp;&amp; ≡ rvalue reference</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后一种情况可以这样看：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">push_back</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&amp;&amp;</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>push_back</code> 的存在依赖于 <code>std::vector&lt;T&gt;</code>，而类模板已经将 <code>T</code> 的类型推导出来了，因此到 <code>push_back</code> 的时候就不再需要推导。</p>
</div>
<div class="paragraph">
<p>对于 universal reference，当参数为左值时，推导类型为 <code>T&amp;</code>，而参数为右值时推导类型为 <code>T</code> 而不是 <code>T&amp;&amp;</code>，而 C++ 是不允许“” 的（因为 ref 根本不是一个实体，只是别名），因此 C++11 引入了所谓的“reference collapsing”：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>右值引用的右值引用转换为右值引用</p>
</li>
<li>
<p>其他都转换为左值引用</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>f(x)</code> 本来会导致 <code>T</code> 被推导为 <code>int &amp;</code>，但是由于 reference collapsing 的存在，最终实例化的结果是 <code>f(int &amp;)</code></p>
</div>
<div class="paragraph">
<p>如果变量本身是一个引用，引用会被忽略，例如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">r1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">10</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">r2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">r1</span><span style="background-color: #f8f8f8">);</span> <span style="color: #999988;font-style: italic">// f(int &amp;)</span>
<span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">r2</span><span style="background-color: #f8f8f8">);</span> <span style="color: #999988;font-style: italic">// f(int &amp;)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>reference collapsing 发生的位置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>模板</p>
</li>
<li>
<p><code>auto</code></p>
</li>
<li>
<p><code>typedef</code></p>
</li>
<li>
<p><code>decltype</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_完美转发">完美转发</h4>
<div class="paragraph">
<p>“完美转发”是指函数模板能够在不改变其参数的 type category 的情况下转发这些参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#34;foo(int &amp;)</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">}</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#34;foo(int &amp;&amp;)</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">}</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">fwd</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">);</span> <span style="background-color: #f8f8f8">}</span>

<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">a</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">);</span>            <span style="color: #999988;font-style: italic">// foo(int &amp;)</span>
    <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">);</span>            <span style="color: #999988;font-style: italic">// foo(int &amp;&amp;)</span>
    <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">move</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">));</span> <span style="color: #999988;font-style: italic">// foo(int &amp;&amp;)</span>
    <span style="background-color: #f8f8f8">fwd</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">);</span>            <span style="color: #999988;font-style: italic">// error</span>
    <span style="background-color: #f8f8f8">fwd</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">);</span>            <span style="color: #999988;font-style: italic">// foo(int &amp;) ?</span>
    <span style="background-color: #f8f8f8">fwd</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">move</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">));</span> <span style="color: #999988;font-style: italic">// foo(int &amp;) ?</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意看上面最后两行，我们预期的是 <code>foo(int &amp;&amp;)</code>，结果却是 <code>foo(int &amp;)</code> 这是为什么呢？因为 <code>fwd</code> 中 <code>i</code> 变成了一个具名对象（named object）。可以这样修改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">fwd</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">typename</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">remove_reference</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">type</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">t</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">noexcept</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">static_cast</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;&amp;&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">t</span><span style="background-color: #f8f8f8">));</span>
<span style="background-color: #f8f8f8">}</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">fwd</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">typename</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">remove_reference</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">type</span> <span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">t</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">noexcept</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">static_cast</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;&amp;&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">t</span><span style="background-color: #f8f8f8">));</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>不过调用点需要修改成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="background-color: #f8f8f8">fwd</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">);</span>            <span style="color: #999988;font-style: italic">// foo(int &amp;&amp;)</span>
<span style="background-color: #f8f8f8">fwd</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">move</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">a</span><span style="background-color: #f8f8f8">));</span> <span style="color: #999988;font-style: italic">// foo(int &amp;&amp;)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>完美转发的一般模式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Args</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">wrapper</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">Args</span><span style="color: #000000;font-weight: bold">&amp;&amp;</span><span style="background-color: #f8f8f8">...</span> <span style="background-color: #f8f8f8">args</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">func</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">forward</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Args</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">args</span><span style="background-color: #f8f8f8">)...);</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>两个必备要素：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>universal reference <code>&amp;&amp;</code>，既能够引用左值也能够引用右值</p>
</li>
<li>
<p><code>std::forward</code></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tbody><tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>…​</code> 在 <code>Args</code> 的左边表示打包，在右边表示解包
</td>
</tr>
</tbody></table>
</div>
<div class="paragraph">
<p>这里 <code>std::forward</code> 能够保持原来 type category 是因为其参数是 universal reference</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_泛型编程">泛型编程</h3>
<div class="sect3">
<h4 id="_变参模板">变参模板</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">print_all</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{}</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Ts</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">print_all</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">car</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">Ts</span><span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">...</span> <span style="background-color: #f8f8f8">cdr</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">car</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#39;\n&#39;</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">print_all</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cdr</span><span style="background-color: #f8f8f8">...);</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在 cppinsights.io 可以看到详细的实例化结果。</p>
</div>
<div class="paragraph">
<p>在继承中也可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Values</span><span style="background-color: #f8f8f8">&gt;</span> <span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">MyTuple</span><span style="background-color: #f8f8f8">;</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">MyTuple</span><span style="color: #000000;font-weight: bold">&lt;&gt;</span> <span style="background-color: #f8f8f8">{};</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">Head</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Tail</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">MyTuple</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Head</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">Tail</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">:</span> <span style="color: #000000;font-weight: bold">private</span> <span style="background-color: #f8f8f8">MyTuple</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Tail</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">{};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>能够实现一些神奇的功能：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">,</span>
          <span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span><span style="background-color: #f8f8f8">&gt;</span>
          <span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">Container</span>
         <span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">Container</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">insert</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">c</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">end</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">T</span><span style="background-color: #f8f8f8">());</span>
<span style="background-color: #f8f8f8">}</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">using</span> <span style="background-color: #f8f8f8">Vec</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">;</span>

<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// error: template std::vector requires 2 arguments but 1 is passed.</span>
    <span style="background-color: #f8f8f8">f</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">string</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">f</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">string</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">Vec</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">();</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>sizeof…​(args)</code> 获取参数的数量</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">size_t</span> <span style="background-color: #f8f8f8">ix</span><span style="background-color: #f8f8f8">,</span> <span style="color: #445588;font-weight: bold">size_t</span> <span style="background-color: #f8f8f8">ed</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Args</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">PrintTupleHelper</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">static</span> <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">print</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">ostream</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">out</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">tuple</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">tp</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
        <span style="background-color: #f8f8f8">out</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">get</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">ix</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">tp</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">ix</span><span style="color: #000000;font-weight: bold">+</span><span style="color: #009999">1</span> <span style="color: #000000;font-weight: bold">==</span> <span style="background-color: #f8f8f8">ed</span> <span style="color: #000000;font-weight: bold">?</span> <span style="color: #d14">&#34;&#34;</span> <span style="color: #000000;font-weight: bold">:</span> <span style="color: #d14">&#34;, &#34;</span><span style="background-color: #f8f8f8">);</span>
        <span style="background-color: #f8f8f8">PrintTupleHelper</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">ix</span><span style="color: #000000;font-weight: bold">+</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">ed</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">print</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">out</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">tp</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">size_t</span> <span style="background-color: #f8f8f8">ed</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Args</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">PrintTupleHelper</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">ed</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">ed</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">static</span> <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">print</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">ostream</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">out</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">tuple</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">tp</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{}</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span><span style="color: #000000;font-weight: bold">...</span> <span style="color: #445588;font-weight: bold">Args</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">ostream</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="color: #000000;font-weight: bold">operator</span><span style="color: #000000;font-weight: bold">&lt;&lt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">ostream</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">out</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">tuple</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">tp</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">out</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#39;(&#39;</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">PrintTupleHelper</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #009999">0</span><span style="background-color: #f8f8f8">,</span> <span style="color: #000000;font-weight: bold">sizeof</span><span style="background-color: #f8f8f8">...(</span><span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">),</span> <span style="background-color: #f8f8f8">Args</span><span style="background-color: #f8f8f8">...</span><span style="color: #000000;font-weight: bold">&gt;::</span><span style="background-color: #f8f8f8">print</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">out</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">tp</span><span style="background-color: #f8f8f8">);</span>
    <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">out</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#39;)&#39;</span><span style="background-color: #f8f8f8">);</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_模板别名">模板别名</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">template</span> <span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #000000;font-weight: bold">typename</span> <span style="color: #445588;font-weight: bold">T</span><span style="background-color: #f8f8f8">&gt;</span>
<span style="color: #000000;font-weight: bold">using</span> <span style="background-color: #f8f8f8">Vec</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">MyAlloc</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">T</span><span style="color: #000000;font-weight: bold">&gt;&gt;</span><span style="background-color: #f8f8f8">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>模板别名不支持特化</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_统一初始化">统一初始化</h3>
<div class="paragraph">
<p>编译器看到 <code>{ t<sub>~1</sub>~, t<sub>~2</sub>~, …​, t<sub>~n</sub>~ }</code> 就会生成一个 <code>initializer_list&lt;T&gt;</code>，内部关联一个 <code>array&lt;T, n&gt;</code>。调用函数（包括 ctor）时如果有接收 <code>initializer_list&lt;T&gt;</code> 的重载，使用该重载版本，否则 <code>array</code> 内的元素会被编译器分解逐一传递给参数。但如果参数是 <code>initializer_list&lt;T&gt;</code>，不允许反过来仅仅传入数个分开的参数。</p>
</div>
<div class="paragraph">
<p>统一初始化使得类型更加安全：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>强制使用 value initialization，即，基础类型的局部变量会被初始化为零值（0 或 <code>nullptr</code>）</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">;</span>    <span style="color: #999988;font-style: italic">// undefined</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">j</span> <span style="background-color: #f8f8f8">{};</span> <span style="color: #999988;font-style: italic">// 0</span></code></pre>
</div>
</div>
</li>
<li>
<p>不允许 narrowing initialization</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">i</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #009999">3.14</span> <span style="background-color: #f8f8f8">};</span> <span style="color: #999988;font-style: italic">// error</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>initializer_list</code> 有一个 <code>private</code> 的构造函数，在遇到 <code>{…​}</code> 时编译器会调用该构造函数</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">nums</span><span style="background-color: #f8f8f8">{</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">3</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">4</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">5</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">6</span><span style="background-color: #f8f8f8">};</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>生成的汇编如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="plaintext">foo():
    push    rbp
    mov     rbp, rsp
    sub     rsp, 80
    mov     DWORD PTR [rbp-48], 1
    mov     DWORD PTR [rbp-44], 2
    mov     DWORD PTR [rbp-40], 3
    mov     DWORD PTR [rbp-36], 4
    mov     DWORD PTR [rbp-32], 5
    mov     DWORD PTR [rbp-28], 6
    lea     rcx, [rbp-48]
    mov     rax, rcx
    mov     edx, 6
    lea     rcx, [rbp-9]
    mov     QWORD PTR [rbp-8], rcx
    nop
    nop
    lea     rcx, [rbp-9]
    mov     rsi, rax
    mov     rdi, rdx
    lea     rax, [rbp-80]
    mov     rdi, rax
    ;; rdi contains the address of nums
    ;; rsi contains the pointer to the first element of the underlying array of initializer_list
    ;; rdx contains the length of the array
    ;; rcx contains the address of the allocator (seems it&#39;s empty)
    call    std::vector&lt;int, std::allocator&lt;int&gt; &gt;::vector(std::initializer_list&lt;int&gt;, std::allocator&lt;int&gt; const&amp;) [complete object constructor]
    lea     rax, [rbp-9]
    mov     rdi, rax
    call    std::__new_allocator&lt;int&gt;::~__new_allocator() [base object destructor]
    nop
    lea     rax, [rbp-80]
    mov     rdi, rax
    call    std::vector&lt;int, std::allocator&lt;int&gt; &gt;::~vector() [complete object destructor]
    leave
    ret</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_其他">其他</h3>
<div class="sect3">
<h4 id="_range_for">range-for</h4>
<div class="literalblock">
<div class="content">
<pre>for ( decl : coll ) {
    statement
}</pre>
</div>
</div>
<div class="paragraph">
<p>实际上会转换为使用 <code>begin</code>/<code>end</code>，另外如果 <code>coll</code> 不是变量的话，会创建额外的变量接收其结果，然后在这个额外的变量上调用 <code>begin</code>/<code>end</code>：</p>
</div>
<div class="literalblock">
<div class="content">
<pre>for (auto _pos = coll.begin(), _end = coll.end(); _pos != _end; ++_pos) {
    decl = *_pos;
    statement
}

for (auto _pos = begin(coll), _end = end(coll); _pos != _end; ++_pos) {
    decl = *_pos;
    statement
}</pre>
</div>
</div>
<div class="paragraph">
<p>注意 range-for 是不会做 <code>explicit</code> 转换的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">C</span> <span style="background-color: #f8f8f8">{</span>
<span style="color: #990000;font-weight: bold">public:</span>
    <span style="color: #000000;font-weight: bold">explicit</span> <span style="background-color: #f8f8f8">C</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">string</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">);</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">vector</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">string</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">ss</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// error</span>
    <span style="color: #000000;font-weight: bold">for</span> <span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">const</span> <span style="background-color: #f8f8f8">C</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">e</span> <span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">ss</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span>
        <span style="background-color: #f8f8f8">...</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_枚举类">枚举类</h4>
<div class="paragraph">
<p>从 C 继承下来的 <code>enum</code> 会将其中的符号导入全局作用域（因此可能会跟宏定义或其他 <code>enum</code> 冲突），而且可以设置 variant 之外的值（非类型安全），C++11 的枚举类解决了这两个问题：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">enum</span> <span style="background-color: #f8f8f8">Token</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// EOF is defined for I/O</span>
    <span style="background-color: #f8f8f8">_EOF</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">0</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">COMMENT</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">KW_IF</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #000000;font-weight: bold">-</span><span style="color: #009999">2</span><span style="background-color: #f8f8f8">,</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">Token</span> <span style="background-color: #f8f8f8">tok</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #d14">&#39;+&#39;</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999988;font-style: italic">// Use int as underlying type</span>
<span style="color: #000000;font-weight: bold">enum</span> <span style="color: #000000;font-weight: bold">class</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">Variant1</span><span style="background-color: #f8f8f8">,</span>
    <span style="background-color: #f8f8f8">Variant2</span><span style="background-color: #f8f8f8">,</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此外从 C++11 开始还能够指定底层的存储整数类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">enum</span> <span style="background-color: #f8f8f8">Byte</span> <span style="color: #000000;font-weight: bold">:</span> <span style="color: #445588;font-weight: bold">unsigned</span> <span style="color: #445588;font-weight: bold">char</span> <span style="background-color: #f8f8f8">{};</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_nullptrnoexceptoverridefinal_和_constexpr">nullptr、noexcept、override、final 和 constexpr</h4>
<div class="paragraph">
<p>在 C++11 之前，想要设置空指针只能够使用从 C 继承来的 NULL，但是可能会有问题：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span><span style="background-color: #f8f8f8">);</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">f</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">void</span> <span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">);</span>

<span style="color: #999988;font-style: italic">// if NULL is defined as:</span>
<span style="color: #999999;font-weight: bold">#define NULL (0)
</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// error: call to &#39;f&#39; is ambiguous</span>
    <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">(</span><span style="color: #0086B3">NULL</span><span style="background-color: #f8f8f8">);</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>nullptr</code> 的类型是 <code>std::nullptr_t</code>，可以被转换为任何指针类型，但是不能够转换为整数类型。</p>
</div>
<div class="paragraph">
<p><code>noexcept</code> 用于声明函数在（一定条件下）不会抛出异常，如果在满足条件的情况下抛出了异常，会调用 <code>std::terminate</code> 结束程序。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999988;font-style: italic">// These are equivalent:</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">foo</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">noexcept</span><span style="background-color: #f8f8f8">;</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">foo</span><span style="background-color: #f8f8f8">()</span> <span style="color: #000000;font-weight: bold">noexcept</span><span style="background-color: #f8f8f8">(</span><span style="color: #0086B3">true</span><span style="background-color: #f8f8f8">);</span>

<span style="color: #999988;font-style: italic">// swap does not throw as long as x.swap(y) does not throw</span>
<span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">swap</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">T</span> <span style="color: #000000;font-weight: bold">&amp;</span><span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">noexcept</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">noexcept</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">swap</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">y</span><span style="background-color: #f8f8f8">)));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://stackoverflow.com/questions/8001823/how-to-enforce-move-semantics-when-a-vector-grows" class="bare">https://stackoverflow.com/questions/8001823/how-to-enforce-move-semantics-when-a-vector-grows</a></p>
</div>
<div class="paragraph">
<p><code>override</code> 用于检查子类的 <code>virtual</code> 成员函数确实重写了父类的 <code>virtual</code> 成员函数</p>
</div>
<div class="paragraph">
<p><code>final</code> 的效果跟 Java 的一样：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>修饰 <code>class</code>，表示不能被继承</p>
</li>
<li>
<p>修饰虚函数，表示不能被 override</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">A</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">virtual</span> <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">int</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{}</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">B</span> <span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">A</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #999988;font-style: italic">// error</span>
    <span style="color: #000000;font-weight: bold">virtual</span> <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">f</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">double</span><span style="background-color: #f8f8f8">)</span> <span style="color: #000000;font-weight: bold">override</span> <span style="background-color: #f8f8f8">{}</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>constexpr</code> 用于修饰变量或者函数（包括构造函数），用于实现编译期计算。在修饰变量时，变量必须在编译期初始化，而修饰函数时，只有在必须进行编译期计算的情况下才这样做，参见 <a href="https://learn.microsoft.com/en-us/cpp/cpp/constexpr-cpp?view=msvc-170" class="bare">https://learn.microsoft.com/en-us/cpp/cpp/constexpr-cpp?view=msvc-170</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_explicit_新功能">explicit 新功能</h4>
<div class="paragraph">
<p>能够用于多个参数的构造函数，防止如下形式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="background-color: #f8f8f8">A</span> <span style="background-color: #f8f8f8">a</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">{</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">};</span> <span style="color: #999988;font-style: italic">// error</span>
<span style="background-color: #f8f8f8">A</span> <span style="background-color: #f8f8f8">b</span> <span style="background-color: #f8f8f8">{</span><span style="color: #009999">1</span><span style="background-color: #f8f8f8">,</span> <span style="color: #009999">2</span><span style="background-color: #f8f8f8">};</span>   <span style="color: #999988;font-style: italic">// OK</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>详见 cppreference 的<a href="https://en.cppreference.com/w/cpp/language/explicit">示例</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_默认成员_initializer">默认成员 initializer</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">A</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">A</span><span style="background-color: #f8f8f8">()</span><span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">(</span><span style="color: #009999">42</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{}</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以简化：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">class</span> <span style="color: #445588;font-weight: bold">A</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">x</span> <span style="color: #000000;font-weight: bold">=</span> <span style="color: #009999">42</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>应该尽可能使用这个特性，最大程度地避免直接写构造函数</p>
</div>
</div>
<div class="sect3">
<h4 id="_用户定义字面量">用户定义字面量</h4>
<div class="paragraph">
<p>允许自定义后缀，不过接收的参数非常局限，只有 <code>long double</code> 和 <code>const char *</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #000000;font-weight: bold">constexpr</span> <span style="background-color: #f8f8f8">Imaginary</span> <span style="color: #000000;font-weight: bold">operator</span><span style="color: #d14">&#34;&#34;</span><span style="background-color: #f8f8f8">i</span><span style="background-color: #f8f8f8">(</span><span style="color: #445588;font-weight: bold">long</span> <span style="color: #445588;font-weight: bold">double</span> <span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">)</span> <span style="background-color: #f8f8f8">{</span> <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">Imaginary</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">x</span><span style="background-color: #f8f8f8">);</span> <span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后就可以 <code>1.2 + 3.4i</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_字符串字面量">字符串字面量</h4>
<div class="paragraph">
<p>在写 regex 时很有用</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">regex</span> <span style="background-color: #f8f8f8">p1</span> <span style="background-color: #f8f8f8">{</span><span style="color: #d14">&#34;</span><span style="color: #d14">\\</span><span style="color: #d14">w{2}</span><span style="color: #d14">\\</span><span style="color: #d14">s*</span><span style="color: #d14">\\</span><span style="color: #d14">d{5}(-</span><span style="color: #d14">\\</span><span style="color: #d14">d{4})?&#34;</span><span style="background-color: #f8f8f8">};</span> <span style="color: #999988;font-style: italic">// ordinary literal</span>
<span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">regex</span> <span style="background-color: #f8f8f8">p2</span> <span style="background-color: #f8f8f8">{</span><span style="color: #d14">R&#34;(\w{2}\s*\d{5}(-\d{4})?)&#34;</span><span style="background-color: #f8f8f8">};</span>  <span style="color: #999988;font-style: italic">// raw literal</span>
<span style="color: #999988;font-style: italic">// customized delimiter:</span>
<span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">regex</span> <span style="background-color: #f8f8f8">p2</span> <span style="background-color: #f8f8f8">{</span><span style="color: #d14">R&#34;::(hello)::&#34;</span><span style="background-color: #f8f8f8">};</span>  <span style="color: #999988;font-style: italic">// raw literal</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>括号中的内容只要不包含 <code>)<em>delimiter</em></code> 即可，这个特性在可能会包含括号时很有用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">regex</span> <span style="background-color: #f8f8f8">p3</span> <span style="background-color: #f8f8f8">{</span><span style="color: #d14">R&#34;--((()()))--&#34;</span><span style="background-color: #f8f8f8">};</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_属性">属性</h4>
<div class="paragraph">
<p>在 C++11 之前，编译器本身也支持 <code><em>attribute</em>(())</code> 声明属性，现在只不过是规范化了，而且 C++11 仅提供了两个标准属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="background-color: #f8f8f8">[[</span><span style="background-color: #f8f8f8">noreturn</span><span style="background-color: #f8f8f8">]]</span> <span style="color: #445588;font-weight: bold">void</span> <span style="color: #990000;font-weight: bold">forever</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #000000;font-weight: bold">while</span> <span style="background-color: #f8f8f8">(</span><span style="color: #0086B3">true</span><span style="background-color: #f8f8f8">)</span>
        <span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_库">库</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_智能指针">智能指针</h3>
<div class="paragraph">
<p>三个新的智能指针 <code>std::shared_ptr</code> <code>std::unique_ptr</code> 和 <code>std::weak_ptr</code></p>
</div>
<div class="paragraph">
<p>详见 CppCon 2020 上 Rainer Grimm 的 Smart Pointers 讲座</p>
</div>
<div class="sect3">
<h4 id="_enable_shared_from_this">enable_shared_from_this</h4>
<div class="paragraph">
<p>关于为什么需要 <code>enable_shared_from_this</code>，参见<a href="https://stackoverflow.com/questions/712279/what-is-the-usefulness-of-enable-shared-from-this">这个回答</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_aliasing_constructor">Aliasing Constructor</h4>
<div class="paragraph">
<p>Aliasing Ctor 有两个参数，分别为 owned pointer 和 stored pointer，前者是常规的引用计数（即，构造时增加引用计数，析构时减少引用计数，<code>use_count</code> 返回的是 owned pointer 的引用计数），后者不会管理引用计数，但是 <code>operator*</code> 会返回其引用。</p>
</div>
<div class="paragraph">
<p>这个功能可以用于指向已经被托管（managed）的对象的成员，跟 buffer pool 的 pin 操作有一点相似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999999;font-weight: bold">#include</span> <span style="color: #999988;font-style: italic">&lt;memory&gt;</span><span style="color: #999999;font-weight: bold">
</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">A</span> <span style="background-color: #f8f8f8">{</span>
    <span style="color: #445588;font-weight: bold">int</span> <span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">A</span><span style="background-color: #f8f8f8">()</span><span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">(</span><span style="color: #000000;font-weight: bold">new</span> <span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">{</span><span style="color: #009999">42</span><span style="background-color: #f8f8f8">})</span> <span style="background-color: #f8f8f8">{}</span>
    <span style="color: #000000;font-weight: bold">~</span><span style="background-color: #f8f8f8">A</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #000000;font-weight: bold">if</span> <span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">)</span>
            <span style="color: #000000;font-weight: bold">delete</span> <span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">p2</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">{</span>
        <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">A</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">p1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">make_shared</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">A</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">();</span>
        <span style="background-color: #f8f8f8">p2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="color: #445588;font-weight: bold">int</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">p1</span><span style="background-color: #f8f8f8">,</span> <span style="background-color: #f8f8f8">p1</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">data</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #000000;font-weight: bold">*</span><span style="background-color: #f8f8f8">p2</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#39;\n&#39;</span><span style="background-color: #f8f8f8">;</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>注意 <code>p1</code> 和 <code>p2</code> 类型的差别。如果 <code>p2</code> 没有 co-own <code>p1</code>（例如 <code>p2</code> 仅仅是一个 <code>int *</code>），那么 <code>p1</code> 离开作用域时，其管理的对象就会被析构，这样最后一行就可能访问到垃圾数据（例如，我在 Compiler Explorer 上测试的结果是打印 <code>0</code> 而非 <code>42</code>）。</p>
</div>
<div class="paragraph">
<p>下面是来自 cppreference 的一个示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight" style="background-color: #f8f8f8"><code data-lang="c++"><span style="color: #999999;font-weight: bold">#include</span> <span style="color: #999988;font-style: italic">&lt;iostream&gt;</span><span style="color: #999999;font-weight: bold">
#include</span> <span style="color: #999988;font-style: italic">&lt;memory&gt;</span><span style="color: #999999;font-weight: bold">
</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">MyObj</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">MyObj</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#34;</span><span style="color: #d14">\x1b</span><span style="color: #d14">[1;32mMyObj constructed</span><span style="color: #d14">\x1b</span><span style="color: #d14">[0m</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">}</span>
    <span style="color: #000000;font-weight: bold">~</span><span style="background-color: #f8f8f8">MyObj</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">cout</span> <span style="color: #000000;font-weight: bold">&lt;&lt;</span> <span style="color: #d14">&#34;</span><span style="color: #d14">\x1b</span><span style="color: #d14">[1;32mMyObj destructed</span><span style="color: #d14">\x1b</span><span style="color: #d14">[0m</span><span style="color: #d14">\n</span><span style="color: #d14">&#34;</span><span style="background-color: #f8f8f8">;</span> <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #999988;font-style: italic">// note: public inheritance</span>
<span style="color: #000000;font-weight: bold">struct</span> <span style="color: #445588;font-weight: bold">Container</span> <span style="color: #000000;font-weight: bold">:</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">enable_shared_from_this</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Container</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">MyObj</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">;</span>

    <span style="color: #445588;font-weight: bold">void</span> <span style="background-color: #f8f8f8">CreateMember</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span> <span style="background-color: #f8f8f8">memberObj</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">make_shared</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">MyObj</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">();</span> <span style="background-color: #f8f8f8">}</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">MyObj</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">GetAsMyObj</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
        <span style="color: #000000;font-weight: bold">return</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">MyObj</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">shared_from_this</span><span style="background-color: #f8f8f8">(),</span> <span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">get</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">}</span>
<span style="background-color: #f8f8f8">};</span>

<span style="color: #999999;font-weight: bold">#define COUT(str) std::cout &lt;&lt; &#34;\n=== &#34; &lt;&lt; str &lt;&lt; &#34; ===\n&#34;
#define DEMO(...) std::cout &lt;&lt; #__VA_ARGS__ &lt;&lt; &#34; = &#34; &lt;&lt; __VA_ARGS__ &lt;&lt; &#39;\n&#39;
</span>
<span style="color: #445588;font-weight: bold">int</span> <span style="background-color: #f8f8f8">main</span><span style="background-color: #f8f8f8">()</span> <span style="background-color: #f8f8f8">{</span>
    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Creating shared container&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Container</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">cont</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">make_shared</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Container</span><span style="color: #000000;font-weight: bold">&gt;</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Creating member&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">CreateMember</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Creating another shared container&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">Container</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">cont2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont2</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;GetAsMyObj&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">MyObj</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">myobj1</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">GetAsMyObj</span><span style="background-color: #f8f8f8">();</span>
    <span style="color: #999988;font-style: italic">// myobj1 co-owns the object pointed-to by cont, so the result of use_count is the same as cont</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj1</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont2</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Copying alias obj&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">std</span><span style="color: #000000;font-weight: bold">::</span><span style="background-color: #f8f8f8">shared_ptr</span><span style="color: #000000;font-weight: bold">&lt;</span><span style="background-color: #f8f8f8">MyObj</span><span style="color: #000000;font-weight: bold">&gt;</span> <span style="background-color: #f8f8f8">myobj2</span> <span style="color: #000000;font-weight: bold">=</span> <span style="background-color: #f8f8f8">myobj1</span><span style="background-color: #f8f8f8">;</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj1</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont2</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Resetting cont2&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">cont2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">reset</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj1</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Resetting myobj2&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">myobj2</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">reset</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj1</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="color: #000000;font-weight: bold">-&gt;</span><span style="background-color: #f8f8f8">memberObj</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>

    <span style="background-color: #f8f8f8">COUT</span><span style="background-color: #f8f8f8">(</span><span style="color: #d14">&#34;Resetting cont&#34;</span><span style="background-color: #f8f8f8">);</span>
    <span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">reset</span><span style="background-color: #f8f8f8">();</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">myobj1</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
    <span style="background-color: #f8f8f8">DEMO</span><span style="background-color: #f8f8f8">(</span><span style="background-color: #f8f8f8">cont</span><span style="background-color: #f8f8f8">.</span><span style="background-color: #f8f8f8">use_count</span><span style="background-color: #f8f8f8">());</span>
<span style="background-color: #f8f8f8">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_并发编程">并发编程</h3>
<div class="paragraph">
<p>是一块很大的内容，详见 C++ Concurrency in Action 这本书</p>
</div>
<div class="sect3">
<h4 id="_exception_ptr">exception_ptr</h4>
<div class="paragraph">
<p>参见 <a href="https://cplusplus.com/reference/exception/exception_ptr/" class="bare">https://cplusplus.com/reference/exception/exception_ptr/</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tuple">tuple</h3>
<div class="paragraph">
<p>参见 <a href="https://www.geeksforgeeks.org/tuples-in-c/" class="bare">https://www.geeksforgeeks.org/tuples-in-c/</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_emplace">emplace</h3>
<div class="paragraph">
<p><code>emplace</code> 主要是为了避免构造临时对象，这个特性需要基于 variadic template 和完美转发，参见 link:https://www.stroustrup.com/C11FAQ.html[$$C11$$ FAQ] 的 <em>Container improvements</em> 一节，另外可以参见 <a href="https://stackoverflow.com/questions/4303513/push-back-vs-emplace-back" class="bare">https://stackoverflow.com/questions/4303513/push-back-vs-emplace-back</a></p>
</div>
<div class="paragraph">
<p>示例见 <a href="https://cplusplus.com/reference/map/map/emplace/，需要注意" class="bare">https://cplusplus.com/reference/map/map/emplace/，需要注意</a> <code>map</code> 的 <code>insert</code> 函数对于 <code>std::pair</code> 没有右值引用的版本，参见 <a href="https://cplusplus.com/reference/map/map/insert/" class="bare">https://cplusplus.com/reference/map/map/insert/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_参考">参考</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="ms-lambda-intro"></a>[ms-lambda-intro] <a href="https://learn.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=msvc-170" class="bare">https://learn.microsoft.com/en-us/cpp/cpp/lambda-expressions-in-cpp?view=msvc-170</a></p>
</li>
<li>
<p><a id="ms-lambda-examples"></a>[ms-lambda-examples] <a href="https://learn.microsoft.com/en-us/cpp/cpp/examples-of-lambda-expressions?view=msvc-170" class="bare">https://learn.microsoft.com/en-us/cpp/cpp/examples-of-lambda-expressions?view=msvc-170</a></p>
</li>
<li>
<p><a id="cppref-auto"></a>[auto - cppreference] <a href="https://en.cppreference.com/w/cpp/language/auto" class="bare">https://en.cppreference.com/w/cpp/language/auto</a></p>
</li>
<li>
<p><a id="perfect-forward-modernescpp"></a>[perfect-forward-modernescpp] <a href="https://www.modernescpp.com/index.php/perfect-forwarding" class="bare">https://www.modernescpp.com/index.php/perfect-forwarding</a></p>
</li>
<li>
<p><a id="ref-collapse"></a>[C++ Reference Collapsing] <a href="https://leimao.github.io/blog/CPP-Reference-Collapsing/" class="bare">https://leimao.github.io/blog/CPP-Reference-Collapsing/</a></p>
</li>
<li>
<p><a id="jjhou-11-14-new-features"></a>[C++11/14 新特性 by 侯捷] 版权原因，请自行搜索</p>
</li>
</ul>
</div>
</div>
</div>

	

	<ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5">
  <li>
    <a class="btn btn-primary disabled"><span class="mr-1">←</span>上一页</a>
  </li>
  <li>
    <a class="btn btn-primary disabled">下一页<span class="ml-1">→</span></a>
  </li>
</ul>

</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="E-mail" aria-label="E-mail">
    <a class="text-white" target="_blank" rel="noopener" href="mailto:my@rhanqtl.com" aria-label="E-mail">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https:/github.com/rhanqtl" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/rhanqtl" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2023 rhanqtl 保留所有权利</small>
        
	
		<p class="mt-2"><a href="/about/">个人简历</a></p>
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
  <script src="/js/main.min.be25a680a0d95dc8b5d6664622e2134aa894220e2f224ef609e00f633a3a1b32.js" integrity="sha256-viWmgKDZXci11mZGIuITSqiUIg4vIk72CeAPYzo6GzI=" crossorigin="anonymous"></script>
<script src='/js/tabpane-persist.js'></script>

  </body>
</html>